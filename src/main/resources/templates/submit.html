<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Submit</title>
</head>
<body>
<h2>Submit code:</h2>
<div>
    <label for="language">Programming language</label>
    <select id="language" name="language">
        <option selected>Not specified</option>
        <option>Java</option>
    </select>
</div><br/>
<div>
    <label for="code">Code</label><br/>
    <textarea id="code" name="code" rows="5" cols="40"></textarea>
</div>

<div>
    <label for="tags">Tags (separated by space): </label>
    <input type="text" id="tags" name="tags">
    <input type="checkbox" id="tags-toggle" checked>
</div>

<button type="button" id="submit-button">Submit</button>

<script>
    const langSelect=document.getElementById("language");
    const codeInput=document.getElementById("code");
    const tagsInput=document.getElementById("tags");

    const tagsToggle=document.getElementById("tags-toggle");

    const toggleSwitch = function (inputCheckbox,...elements) {
        inputCheckbox.addEventListener("click",e=>{
            if (inputCheckbox.checked){
                elements.forEach(e=>{
                    e.disabled=null;
                });
            } else {
                elements.forEach(e=>{
                    e.disabled=1;
                });
            }
        })
    }
    toggleSwitch(tagsToggle,tagsInput);

    document.getElementById("submit-button").addEventListener("click", e=>{
        const t = tagsToggle.checked;
        const data = new FormData();
        if (langSelect.selectedIndex>0){
            const lang = langSelect.options[langSelect.selectedIndex].text;
            data.append("language",lang);
        }
        const code = codeInput.value;
        data.append("code",code);

        if (t){
            let tags = ""+tagsInput.value;
            data.append("tags",tags);
        }

        const xhr = new XMLHttpRequest();
        xhr.overrideMimeType("application/json");
        xhr.open('POST', '/send-code', true);
        xhr.onload = function () {
            console.log(xhr.status);
            if (xhr.status===200){
                let jsonResponse = JSON.parse(xhr.responseText);
                console.log(xhr.responseText);
            } else {
                alert(xhr.status)
            }
        };
        xhr.send(data);
    });
</script>
</body>
</html>